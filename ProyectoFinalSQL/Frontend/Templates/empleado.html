<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Empleado - EntreCOL+</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='empleado.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>

  <header>
    <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
    <div class="logo"><span>Entrecol +</span></div>
  </header>

  <div id="side-menu" class="dropdown-menu">
    <ul>
      <li><a href="{{ url_for('inicio') }}">Inicio</a></li>
      <li><a href="/login">Cerrar sesi√≥n</a></li>
    </ul>
  </div>

  <div class="panel">
    <div class="panel-banner">
      <h1>Bienvenido, Empleado</h1>
      <p>Aqu√≠ puedes consultar tu informaci√≥n de n√≥mina y registrar novedades.</p>
    </div>
 
 </div>
    <!-- üîç Secci√≥n de b√∫squeda por c√≥digo -->
    <div class="buscar-empleado">
      <h2> Consultar Empleado (codigo)</h2>
      <input type="text" id="codigoEmpleado" placeholder="C√≥digo del empleado">
      <button onclick="buscarEmpleado()">Buscar</button>
    </div>

    <div id="resultadoEmpleado" class="resultado-empleado"></div>
  </div>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("side-menu");
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }

    window.addEventListener("click", function (e) {
      const menu = document.getElementById("side-menu");
      const icon = document.querySelector(".menu-icon");
      if (!menu.contains(e.target) && !icon.contains(e.target)) {
        menu.style.display = "none";
      }
    });

    function buscarEmpleado() {
      const codigo = document.getElementById("codigoEmpleado").value;
      fetch(`/empleado/info?codigo=${codigo}`)
        .then(r => r.json())
        .then(data => {
          const contenedor = document.getElementById("resultadoEmpleado");
          contenedor.innerHTML = "";

          if (data.length === 0) {
            contenedor.innerHTML = "<p>No se encontraron datos para ese c√≥digo.</p>";
            return;
          }

          const emp = data[0];

        contenedor.innerHTML = `
          <div class="resultado-empleado">
          <h3>üë§ Datos Personales</h3>
          <table>
            <tr><th>C√≥digo</th><td>${emp.codigo_empleado}</td></tr>
            <tr><th>Nombre</th><td>${emp.nombre_empleado}</td></tr>
            <tr><th>Cargo</th><td>${emp.nombre_cargo}</td></tr>
            <tr><th>Dependencia</th><td>${emp.nombre_dependencia}</td></tr>
            <tr><th>Sueldo</th><td>$${emp.sueldo}</td></tr>
            <tr><th>EPS</th><td>${emp.nombre_eps}</td></tr>
            <tr><th>ARL</th><td>${emp.nombre_arl}</td></tr>
            <tr><th>Pensi√≥n</th><td>${emp.nombre_pension}</td></tr>
          </table>

          <h3 style="margin-top:30px;">üìã Novedades Laborales</h3>
          <table>
            <tr><th>D√≠as trabajados</th><td>${emp.dias_trabajados}</td></tr>
            <tr><th>Bonificaci√≥n</th><td>$${emp.bonificacion}</td></tr>
            <tr><th>Transporte</th><td>$${emp.transporte}</td></tr>
          </table>

          <h3 style="margin-top:30px;">üèñÔ∏è Vacaciones</h3>
          <table>
            <tr><th>Inicio</th><td>${emp.vac_inicio || "-"}</td></tr>
            <tr><th>Fin</th><td>${emp.vac_fin || "-"}</td></tr>
          </table>

          <h3 style="margin-top:30px;">ü©∫ Incapacidad</h3>
          <table>
            <tr><th>Inicio</th><td>${emp.inc_inicio || "-"}</td></tr>
            <tr><th>Fin</th><td>${emp.inc_fin || "-"}</td></tr>
            <tr><th>Tipo</th><td>${emp.tipo_incapacidad || "-"}</td></tr>
          </table>
          <div class="boton-pdf-container">
           <button class="boton-pdf" onclick="descargarPDF('${emp.codigo_empleado}')">
              üìÑ Descargar PDF N√≥mina
           </button>
          </div>
          <div class="boton-pdf-container">
             <a href="/login" class="boton-pdf">Cerrar sesi√≥n</a>
          </div>

        </div>
      `;
     });
   }

    function descargarPDF(codigo) {
      window.open(`/empleado/nomina_pdf?codigo=${codigo}`, '_blank');
    }

  </script>
</body>
</html>
