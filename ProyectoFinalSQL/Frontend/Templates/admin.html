<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Administrador - EntreCOL+</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>

  <header>
    <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
    <div class="logo"><span>Entrecol +</span></div>
  </header>

  <div id="side-menu" class="dropdown-menu">
    <ul>
      <li><a href="/Inicio">Inicio</a></li>
      <li><a href="/login">Cerrar sesión</a></li>
    </ul>
  </div>
<div class="admin-container">

        <div class="admin-banner">
            <h1>Bienvenido, Administrador</h1>
            <p>Consulta, edita o elimina empleados desde este panel.</p>
        </div>
  
      <div class="admin-grid">
            <a href="" class="admin-card">Administrar novedad</a>
        <a href="#" onclick="abrirModal()" class="admin-card">Crear nuevo empleado</a>
        </div>
    <div class="buscar-empleado">
      <h2> Buscar Empleado por Código</h2>
      <input type="text" id="codigoEmpleado" placeholder="Código del empleado">
      <button onclick="buscarEmpleado()">Buscar</button>
    </div>

    <div id="resultadoEmpleado" class="resultado-empleado"></div>
  </div>
   
  <script>
    function toggleMenu() {
      const menu = document.getElementById("side-menu");
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }

    function buscarEmpleado() {
      const codigo = document.getElementById("codigoEmpleado").value;
      fetch(`/empleado/info?codigo=${codigo}`)
        .then(r => r.json())
        .then(data => {
          const contenedor = document.getElementById("resultadoEmpleado");
          contenedor.innerHTML = "";

          if (data.length === 0) {
            contenedor.innerHTML = "<p>No se encontraron datos para ese código.</p>";
            return;
          }

          const emp = data[0];

          contenedor.innerHTML = `
            <h3>👤 Datos Personales</h3>
            <table>
              <tr><th>Código</th><td>${emp.codigo_empleado}</td></tr>
              <tr><th>Nombre</th><td>${emp.nombre_empleado}</td></tr>
              <tr><th>Cargo</th><td>${emp.nombre_cargo}</td></tr>
              <tr><th>Dependencia</th><td>${emp.nombre_dependencia}</td></tr>
              <tr><th>Sueldo</th><td>$${emp.sueldo}</td></tr>
              <tr><th>EPS</th><td>${emp.nombre_eps}</td></tr>
              <tr><th>ARL</th><td>${emp.nombre_arl}</td></tr>
              <tr><th>Pensión</th><td>${emp.nombre_pension}</td></tr>
            </table>

            <div style="margin-top: 20px;">
              <button onclick="eliminarEmpleado(${emp.codigo_empleado})" style="background-color:#c62828;color:white;padding:10px;border:none;border-radius:6px;">Eliminar</button>
              <button onclick="editarEmpleado(${emp.codigo_empleado})" style="margin-left:10px;background-color:#1976d2;color:white;padding:10px;border:none;border-radius:6px;">Editar</button>
            </div>
          `;
        });
    }

    function eliminarEmpleado(codigo) {
      if (confirm("¿Estás seguro de que deseas eliminar este empleado?")) {
        fetch(`/empleado/eliminar?codigo=${codigo}`, { method: "DELETE" })
          .then(r => r.json())
          .then(data => {
            alert(data.mensaje || "Empleado eliminado");
            document.getElementById("resultadoEmpleado").innerHTML = "";
          });
      }
    }


    function editarEmpleado(codigo) {
    fetch(`/empleado/info?codigo=${codigo}`)
        .then(r => r.json())
        .then(data => {
        const emp = data[0];
        document.getElementById("editCodigo").value = emp.codigo_empleado;
        document.getElementById("editNombre").value = emp.nombre_empleado;
        document.getElementById("editApellido").value = emp.apellido_empleado;
        document.getElementById("editFecha").value = emp.fecha_ingreso;

        document.getElementById("editDependencia").value = emp.id_dependencia;
        document.getElementById("editCargo").value = emp.id_cargo;
        document.getElementById("editEps").value = emp.id_eps;
        document.getElementById("editArl").value = emp.id_arl;
        document.getElementById("editPension").value = emp.id_pension;
        document.getElementById("editSueldo").value = emp.sueldo;

        document.getElementById("modalEditarEmpleado").style.display = "block";
        });
    }

    function cerrarModalEditar() {
    document.getElementById("modalEditarEmpleado").style.display = "none";
    }

    window.onclick = function(event) {
    const modalCrear = document.getElementById("modalCrearEmpleado");
    const modalEditar = document.getElementById("modalEditarEmpleado");

    if (event.target === modalCrear) {
        modalCrear.style.display = "none";
    }

    if (event.target === modalEditar) {
        modalEditar.style.display = "none";
    }
    }
    

    function abrirModal() {
  document.getElementById("modalCrearEmpleado").style.display = "block";
    }

    function cerrarModal() {
  document.getElementById("modalCrearEmpleado").style.display = "none";
    }

    window.onclick = function (event) {
  const modal = document.getElementById("modalCrearEmpleado");
  if (event.target == modal) {
    modal.style.display = "none";
  }
    }

  </script>
    <!-- MODAL: Crear nuevo empleado -->
<div id="modalCrearEmpleado" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModal()">&times;</span>
    <h2>Crear nuevo empleado</h2>
    <form id="formCrearEmpleado" method="POST" action="/empleado/crear">
      <input type="text" name="codigo" placeholder="Código" required><br>
      <input type="text" name="nombre" placeholder="Nombre" required><br>
      <input type="text" name="apellido" placeholder="Apellido" required><br>


      <select name="dependencia" required>
        <option disabled selected>Dependencia</option>
        {% for d in dependencias %}
        <option value="{{ d.id_dependencia }}">{{ d.nombre_dependencia }}</option>
        {% endfor %}
      </select><br>

      <select name="cargo" required>
        <option disabled selected>Cargo</option>
        {% for c in cargos %}
        <option value="{{ c.id_cargo }}">{{ c.nombre_cargo }}</option>
        {% endfor %}
      </select><br>

      <input type="date" name="fecha" placeholder="Fecha ingreso" required><br>

      <select name="eps" required>
        <option disabled selected>EPS</option>
        {% for e in eps %}
        <option value="{{ e.id_eps }}">{{ e.nombre_eps }}</option>
        {% endfor %}
      </select><br>

      <select name="arl" required>
        <option disabled selected>ARL</option>
        {% for a in arl %}
        <option value="{{ a.id_arl }}">{{ a.nombre_arl }}</option>
        {% endfor %}
      </select><br>

      <select name="pension" required>
        <option disabled selected>Pensión</option>
        {% for p in pension %}
        <option value="{{ p.id_pension }}">{{ p.nombre_pension }}</option>
        {% endfor %}
      </select><br>

      <input type="text" name="sueldo" placeholder="Sueldo" required><br><br>

      <button type="submit">Crear empleado</button>
    </form>
  </div>
</div>
<!-- MODAL: Editar empleado -->
<div id="modalEditarEmpleado" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModalEditar()">&times;</span>
    <h2>Editar empleado</h2>
    <form id="formEditarEmpleado" method="POST" action="/empleado/actualizar">
      <input type="hidden" name="codigo" id="editCodigo" required>

      <input type="text" name="nombre" id="editNombre" placeholder="Nombre" required><br>
      <input type="text" name="apellido" id="editApellido" placeholder="Apellido" required><br>

      <select name="dependencia" id="editDependencia" required>
        <option disabled selected>Dependencia</option>
        {% for d in dependencias %}
        <option value="{{ d.id_dependencia }}">{{ d.nombre_dependencia }}</option>
        {% endfor %}
      </select><br>

      <select name="cargo" id="editCargo" required>
        <option disabled selected>Cargo</option>
        {% for c in cargos %}
        <option value="{{ c.id_cargo }}">{{ c.nombre_cargo }}</option>
        {% endfor %}
      </select><br>

      <input type="date" name="fecha" id="editFecha" placeholder="Fecha ingreso" required><br>

      <select name="eps" id="editEps" required>
        <option disabled selected>EPS</option>
        {% for e in eps %}
        <option value="{{ e.id_eps }}">{{ e.nombre_eps }}</option>
        {% endfor %}
      </select><br>

      <select name="arl" id="editArl" required>
        <option disabled selected>ARL</option>
        {% for a in arl %}
        <option value="{{ a.id_arl }}">{{ a.nombre_arl }}</option>
        {% endfor %}
      </select><br>

      <select name="pension" id="editPension" required>
        <option disabled selected>Pensión</option>
        {% for p in pension %}
        <option value="{{ p.id_pension }}">{{ p.nombre_pension }}</option>
        {% endfor %}
      </select><br>

      <input type="text" name="sueldo" id="editSueldo" placeholder="Sueldo" required><br><br>

      <button type="submit">Guardar cambios</button>
    </form>
  </div>
</div>

</body>

</html>
